{{/* archives_list.html: htmx fragment for listing archive status of all bookmarks */}}
{{ if .archives }}
    {{ range .archives }}
        <div class="archive-item" 
             id="archive-{{ .ID }}"
             {{ if .IsArchiving }}
             hx-get="/archives/{{ .ID }}/status"
             hx-trigger="load delay:2s"
             hx-swap="outerHTML"
             {{ end }}>
            <div class="archive-header">
                <div class="archive-title">
                    <a href="{{ .URL }}" target="_blank" rel="noopener">{{ .Title }}</a>
                </div>
                <div class="archive-actions">
                    {{ if .IsArchiving }}
                        <span class="spinner spinner-sm" aria-hidden="true"></span>
                        <span class="archiving-text">Archivingâ€¦</span>
                    {{ else if eq .ArchiveStatus "ok" }}
                        <span class="status-dot status-ok" title="Archived {{ .ArchivedAt }}"></span>
                        <a href="/bookmarks/{{ .ID }}/archive" class="view-link">View</a>
                    {{ else if eq .ArchiveStatus "error" }}
                        <span class="status-dot status-error" title="Archive failed"></span>
                    {{ else }}
                        <span class="status-dot status-pending" title="Not archived"></span>
                    {{ end }}
                    <button class="refetch"
                            hx-post="/archives/{{ .ID }}/refetch"
                            hx-target="#archive-{{ .ID }}"
                            hx-swap="outerHTML"
                            hx-disabled-elt="this"
                            hx-indicator="find .btn-indicator"
                            {{ if .IsArchiving }}disabled{{ end }}
                            title="Clear archive and queue for re-archiving">
                        <span class="btn-indicator htmx-indicator spinner spinner-sm" aria-hidden="true"></span>
                        Refetch
                    </button>
                </div>
            </div>
            <div class="archive-url">{{ .URL }}</div>
            {{ if .ArchivedAt }}
                <div class="archive-meta">
                    Archived: {{ .ArchivedAt }}
                    {{ if .ArchiveAttemptedAt }}| Last attempt: {{ .ArchiveAttemptedAt }}{{ end }}
                </div>
            {{ else if .ArchiveAttemptedAt }}
                <div class="archive-meta">Last attempt: {{ .ArchiveAttemptedAt }}</div>
            {{ end }}
            {{ if and (eq .ArchiveStatus "error") .ArchiveError }}
                <div class="archive-error">{{ .ArchiveError }}</div>
            {{ end }}
        </div>
    {{ end }}
{{ else }}
    <div class="empty">No bookmarks yet. Add some from the <a href="/">main page</a>.</div>
{{ end }}
